<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from www.linuxcnc.org/docs/html/install/Latency_Test.html by HTTrack Website Copier/3.x [XR&CO'2013], Wed, 05 Jun 2013 19:13:23 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.2" />
<title>Latency Test</title>
<link rel="stylesheet" href="../xhtml11.css" type="text/css" />
<link rel="stylesheet" href="../xhtml11-quirks.css" type="text/css" />
<link rel="stylesheet" href="../linuxcnc.css" type="text/css" />
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes(); asciidoc.toc(2);}
/*]]>*/
</script>
<script type="text/javascript" src="../asciidoc-xhtml11.js"></script>
</head>
<body>
<div id="header">
<h1>Latency Test</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p><a id="cha:latency-test"></a> </p></div>
<div class="paragraph"><p>This test is the first test that should be performed on a PC
to see if it is able to drive a CNC machine.</p></div>
<div class="paragraph"><p>Latency is how long it takes the PC to stop what it is doing and
respond to an external request. For LinuxCNC the request is
BASE_THREAD that makes the periodic <em>heartbeat</em> that serves as a
timing reference for the step pulses. The lower the latency, the
faster you can run the heartbeat, and the faster and smoother the
step pulses will be.</p></div>
<div class="paragraph"><p>Latency is far more important than CPU speed.
A lowly Pentium II that responds to interrupts within 10 microseconds
each and every time can give better results
than the latest and fastest P4 Hyperthreading beast.</p></div>
<div class="paragraph"><p>The CPU isn&#8217;t the only factor in determining latency.
Motherboards, video cards, USB ports, and
a number of other things can hurt the latency.
The best way to find out what you are dealing with is
to run the RTAI latency test.</p></div>
<div class="paragraph"><p>Generating step pulses in software
has one very big advantage - it&#8217;s free.
Just about every PC has a parallel port that is
capable of outputting step pulses that are generated by the software.
However, software step pulses
also have some disadvantages:</p></div>
<div class="ulist"><ul>
<li>
<p>
limited maximum step rate
</p>
</li>
<li>
<p>
jitter in the generated pulses
</p>
</li>
<li>
<p>
loads the CPU
</p>
</li>
</ul></div>
<div class="paragraph"><p>The best way to find out how well your PC will lrun LinuxCNC
is to run the HAL latency test.
To run the test, open a terminal window
(In Ubuntu, from Applications → Accessories → Terminal)
and run the following command:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>latency-test</tt></pre>
</div></div>
<div class="paragraph"><p>You should see something like this:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="../config/images/latency.png" alt="../config/images/latency.png" />
</div>
<div class="title">Figure 1. HAL Latency Test</div>
</div>
<div class="paragraph"><p>While the test is running, you should <em>abuse</em> the computer.
Move windows around on the screen. Surf the web. Copy some large files
around on the disk. Play some music.
Run an OpenGL program such as glxgears.
The idea is to put the PC through its paces while
the latency test checks to see what the worst case numbers are.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Do not run LinuxCNC or Stepconf while the latency test is running.</td>
</tr></table>
</div>
<div class="paragraph"><p>The important numbers are the <em>max jitter</em>.
In the example above, that is 9075 nanoseconds, or 9.075 microseconds.
Record this number, and enter it in Stepconf when it is requested.</p></div>
<div class="paragraph"><p>In the example above, latency-test only ran for a few seconds.
You should run the test for at least several minutes; sometimes
the worst case latency doesn&#8217;t happen very often, or only happens
when you do some particular action. For instance, one Intel
motherboard worked pretty well most of the time, but every 64
seconds it had a very bad 300 us latency. Fortunately that was
fixable, see <a href="http://wiki.linuxcnc.org/cgi-bin/emcinfo.pl?FixingSMIIssues">http://wiki.linuxcnc.org/cgi-bin/emcinfo.pl?FixingSMIIssues</a></p></div>
<div class="paragraph"><p>So, what do the results mean? If your Max Jitter number is less
than about 15-20 microseconds (15000-20000 nanoseconds), the
computer should give very nice results with software stepping. If
the max latency is more like 30-50 microseconds, you can still
get good results, but your maximum step rate might be a little
disappointing, especially if you use microstepping or have very
fine pitch leadscrews. If the numbers are 100 us or more (100,000
nanoseconds), then the PC is not a good candidate for software
stepping. Numbers over 1 millisecond (1,000,000 nanoseconds) mean
the PC is not a good candidate for LinuxCNC, regardless of whether you
use software stepping or not.</p></div>
<div class="paragraph"><p>Note that if you get high numbers, there may be ways to improve
them. Another PC had very bad latency (several milliseconds) when
using the onboard video. But a $5 used video card solved the
problem.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">LinuxCNC does not require bleeding edge hardware.</td>
</tr></table>
</div>
<div class="paragraph"><p>For more information on stepper tuning see the
<a href="../motion/tweaking_steppers.html#cha:Stepper-Tuning">Stepper Tuning</a> Chapter.</p></div>
</div>
</div>
<h2 id="_port_address">1. Port Address</h2>
<div class="sectionbody">
<div class="paragraph"><p>For those who build their own hardware, one safeguard against
shorting out an on-board parallel port - or even the whole
motherboard - is to use an add-on parallel port card. Even if you
don&#8217;t need the extra layer of safety, a parport card is a good
way to add extra I/O lines with LinuxCNC.</p></div>
<div class="paragraph"><p>One good PCI parport card is made with the Netmos 9815 chipset.
It has good +5V signals, and can come in a single or dual ports.</p></div>
<div class="paragraph"><p>To find the I/O addresses for these cards open a terminal window
and use the list pci command:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>lspci -v</tt></pre>
</div></div>
<div class="paragraph"><p>Look for the entry with "Netmos" in it. Example of a 2-port card:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>0000:01:0a.0 Communication controller: \
      Netmos Technology PCI 9815 Multi-I/O Controller (rev 01)
Subsystem: LSI Logic / Symbios Logic 2POS (2 port parallel adapter)
Flags: medium devsel, IRQ 5
I/O ports at b800 [size=8]
I/O ports at bc00 [size=8]
I/O ports at c000 [size=8]
I/O ports at c400 [size=8]
I/O ports at c800 [size=8]
I/O ports at cc00 [size=16]</tt></pre>
</div></div>
<div class="paragraph"><p>From experimentation, I&#8217;ve found the first port (the on-card
port) uses the third address listed (c000), and the second port
(the one that attaches with a ribbon cable) uses the first
address listed (b800).</p></div>
<div class="paragraph"><p>You can then open an editor and put the addresses into the
appropriate place in your .hal file.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>loadrt hal_parport cfg="0x378 0xc000"</tt></pre>
</div></div>
<div class="paragraph"><p>You must also direct LinuxCNC to run the <em>read</em> and <em>write</em> functions
for the second card. For example,</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>addf parport.1.read base-thread 1
addf parport.1.write base-thread -1</tt></pre>
</div></div>
<div class="paragraph"><p>Please note that your values will differ. The Netmos cards are
Plug-N-Play, and might change their settings depending on which
slot you put them into, so if you like to 'get under the hood'
and re-arrange things, be sure to check these values before you
start LinuxCNC.</p></div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2012-03-30 16:36:04 CDT
</div>
</div>
</body>

<!-- Mirrored from www.linuxcnc.org/docs/html/install/Latency_Test.html by HTTrack Website Copier/3.x [XR&CO'2013], Wed, 05 Jun 2013 19:13:23 GMT -->
</html>
