<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from www.linuxcnc.org/docs/html/common/Stepper_Diagnostics.html by HTTrack Website Copier/3.x [XR&CO'2013], Wed, 05 Jun 2013 19:11:17 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.2" />
<title>Stepper Diagnostics</title>
<link rel="stylesheet" href="../xhtml11.css" type="text/css" />
<link rel="stylesheet" href="../xhtml11-quirks.css" type="text/css" />
<link rel="stylesheet" href="../linuxcnc.css" type="text/css" />
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes(); asciidoc.toc(2);}
/*]]>*/
</script>
<script type="text/javascript" src="../asciidoc-xhtml11.js"></script>
</head>
<body>
<div id="header">
<h1>Stepper Diagnostics</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p><a id="cha:stepper-diagnostics"></a> </p></div>
<div class="paragraph"><p>If what you get is not what you expect many times you just got some
experience. Learning from the experience increases your understanding
of the whole. Diagnosing problems is best done by divide and conquer.
By this I mean if you can remove 1/2 of the variables from the equation
each time you will find the problem the fastest. In the real world this
is not always the case, but it&#8217;s usually a good place to start.</p></div>
</div>
</div>
<h2 id="_common_problems">1. Common Problems</h2>
<div class="sectionbody">
<h3 id="_stepper_moves_one_step">1.1. Stepper Moves One Step</h3><div style="clear:left"></div>
<div class="paragraph"><p>The most common reason in a new installation for a stepper motor not to
move is that the step and direction signals are exchanged. If you press the
jog forward and jog backward keys, alternately , and the stepper moves
one step each time, and in the same direction, there is your clue.</p></div>
<h3 id="_no_steppers_move">1.2. No Steppers Move</h3><div style="clear:left"></div>
<div class="paragraph"><p>Many drives have an enable pin or need a charge pump to enable the
output.</p></div>
<h3 id="_distance_not_correct">1.3. Distance Not Correct</h3><div style="clear:left"></div>
<div class="paragraph"><p>If you command the axis to move a specific distance and it does not
move that distance, then your scale setting is wrong.</p></div>
</div>
<h2 id="_error_messages">2. Error Messages</h2>
<div class="sectionbody">
<h3 id="_following_error">2.1. Following Error</h3><div style="clear:left"></div>
<div class="paragraph"><p>The concept of a following error is strange when talking about stepper
motors. Since they are an open loop system, there is no position
feedback to let you know if you actually are out of range. LinuxCNC
calculates if it can keep up with the motion called for, and if not, then
it gives a following error. Following errors usually are the result of
one of the following on stepper systems.</p></div>
<div class="ulist"><ul>
<li>
<p>
FERROR too small
</p>
</li>
<li>
<p>
MIN_FERROR too small
</p>
</li>
<li>
<p>
MAX_VELOCITY too fast
</p>
</li>
<li>
<p>
MAX_ACCELERATION too fast
</p>
</li>
<li>
<p>
BASE_PERIOD set too long
</p>
</li>
<li>
<p>
Backlash added to an axis
</p>
</li>
</ul></div>
<div class="paragraph"><p>Any of the above can cause the real-time pulsing to not be able to keep up
the requested step rate. This can happen if you didn&#8217;t run the latency
test long enough to get a good number to plug into the Stepconf Wizard,
or if you set the Maximum Velocity or Maximum Acceleration too high.</p></div>
<div class="paragraph"><p>If you added backlash you need to increase the STEPGEN_MAXACCEL up to
double the MAX_ACCELERATION in the AXIS section of the INI file for
each axis you added backlash to. LinuxCNC uses "extra acceleration" at a
reversal to take up the backlash. Without backlash correction, step
generator acceleration can be just a few percent above the motion
planner acceleration.</p></div>
<h3 id="_rtapi_error">2.2. RTAPI Error</h3><div style="clear:left"></div>
<div class="paragraph"><p>When you get this error:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>RTAPI: ERROR: Unexpected realtime delay on task n</tt></pre>
</div></div>
<div class="paragraph"><p>This error is generated by rtapi based on an indication from RTAI that
a deadline was missed. It is usually an indication that the BASE_PERIOD
in the [EMCMOT] section of the ini file is set too low. You should run
the Latency Test for an extended period of time to see if you have any
delays that would cause this problem. If you used the Stepconf Wizard,
run it again, and test the Base Period Jitter again, and adjust the Base
Period Maximum Jitter on the Basic Machine Information page. You might
have to leave the test running for an extended period of time to find
out if some hardware causes intermittent problems.</p></div>
<div class="paragraph"><p>LinuxCNC tracks the number of CPU cycles between invocations of the
real-time thread. If some element of your hardware is causing delays or
your realtime threads are set too fast you will get this error.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This error is only displayed once per session. If you had your
BASE_PERIOD too low you could get hundreds of thousands of error
messages per second if more than one was displayed.</td>
</tr></table>
</div>
</div>
<h2 id="_testing">3. Testing</h2>
<div class="sectionbody">
<h3 id="_step_timing">3.1. Step Timing</h3><div style="clear:left"></div>
<div class="paragraph"><p>If you are seeing an axis ending up in the wrong location over
multiple moves, it is likely that you do not have the correct direction
hold times or step timing for your stepper drivers. Each direction
change may be losing a step or more. If the motors are stalling, it is
also possible you have either the MAX_ACCELERATION or MAX_VELOCITY set
too high for that axis.</p></div>
<div class="paragraph"><p>The following program will test the Z axis configuration for proper
setup. Copy the program to your ~/emc2/nc_files directory and name it
TestZ.ngc or similar. Zero your machine with Z = 0.000 at the table
top. Load and run the program. It will make 200 moves back and forth
from 0.5 to 1". If you have a configuration issue, you will find that
the final position will not end up 0.500" that the axis window is
showing. To test another axis just replace the Z with your axis in the
G0 lines.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>( test program to see if Z axis loses position )
( msg, test 1 of Z axis configuration )
G20 #1000=100 ( loop 100 times )
( this loop has delays after moves )
( tests acc and velocity settings )
o100 while [#1000]
G0 Z1.000
G4 P0.250
G0 Z0.500
G4 P0.250
#1000 = [#1000 - 1]
o100 endwhile
( msg, test 2 of Z axis configuration S to continue)
M1 (stop here)
#1000=100 ( loop 100 times )
( the next loop has no delays after moves )
( tests direction hold times on driver config and also max accel setting )
o101 while [#1000]
G0 Z1.000
G0 Z0.500
#1000 = [#1000 - 1]
o101 endwhile
( msg, Done...Z should be exactly .5" above table )
M2</tt></pre>
</div></div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2012-01-18 16:36:06 CDT
</div>
</div>
</body>

<!-- Mirrored from www.linuxcnc.org/docs/html/common/Stepper_Diagnostics.html by HTTrack Website Copier/3.x [XR&CO'2013], Wed, 05 Jun 2013 19:11:17 GMT -->
</html>
